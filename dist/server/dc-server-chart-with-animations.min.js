/*!
 * dc-addons v0.8.0
 *
 * 2015-07-27 09:16:06
 *
 */
!function(){"use strict";"dc"in window||(window.dc={}),dc.serverChart=function(a,b){function c(a){var b=document.createElement("div");b.innerHTML=a,b=d3.select(b),p.selectAll(".dc-chart").each(function(a,c){var e=d3.select(this),f=b.selectAll(".dc-chart").filter(function(a,b){return b===c}),g=m(e);"function"==typeof dc.serverChart["redraw"+g]?dc.serverChart["redraw"+g](c,e,f):(e.html(f.html()),d())})}function d(){p.selectAll(".dc-chart").each(function(a,b){var c=d3.select(this),d=m(c);"function"==typeof dc.serverChart["attachEvents"+d]&&dc.serverChart["attachEvents"+d](b,c)})}function e(a,b){if(b.select("g.brush").size()>0){var c=b.select("g.brush").select(".background").attr("width");b.select("g.brush").on("mousedown",function(){r=d3.mouse(this),v=t,u=s}).on("mousemove",function(){if(null!==r){var a=d3.mouse(this),b=d3.select(this),d=null;if(w){var e=a[0]-r[0];t=v+e,s=u+e,0>t&&(t=0,s=u-v),s>c&&(s=c,t=c-(u-v))}else x?(t=t,s=a[0],t>s&&(d=t,t=s,s=d,x=!1,y=!0),0>t&&(t=0),s>c&&(s=c)):y?(t=a[0],s=s,t>s&&(d=t,t=s,s=d,x=!0,y=!1),0>t&&(t=0),s>c&&(s=c)):(t=d3.min([a[0],r[0]]),s=d3.max([a[0],r[0]]),0>t&&(t=0),s>c&&(s=c));b.select(".extent").attr("x",t).attr("width",s-t),b.selectAll("g.resize").style("display","inline"),b.select("g.resize.e").attr("transform","translate("+s+", 0)"),b.select("g.resize.w").attr("transform","translate("+t+", 0)")}}).on("mouseup",function(){var b=d3.mouse(this),c=d3.select(this);null===r||b[0]===r[0]?(c.select(".extent").attr("width",0),c.selectAll("g.resize").style("display","none"),f(a,[null,null])):f(a,[t,s]),r=null}),b.select("g.brush").select(".extent").on("mousedown",function(){w=!0}).on("mouseup",function(){w=!1}),b.select("g.brush").select("g.resize.e").on("mousedown",function(){x=!0}).on("mouseup",function(){x=!1}),b.select("g.brush").select("g.resize.w").on("mousedown",function(){y=!0}).on("mouseup",function(){y=!1})}}function f(a,b){o.emit("filter",[a,b])}function g(){k(),o.emit("render",b)}function h(a){p.selectAll("*").remove();for(var b=0;b<a.length;b++)p.append("div").style("width",a[b].width+"px").style("height",a[b].height+"px").style("float","left").style("text-align","center").style("line-height",a[b].height+"px").html(q.loadingMessage)}function i(a){p.html(a),d()}function j(a){p.html(q.errorMessage),console.warn(a)}function k(){p.html(q.loadingMessage)}function l(){o=io(q.server),o.on("preRender",h),o.on("afterRender",i),o.on("afterRenderError",j),o.on("afterFilter",c),o.on("afterFilterError",j)}function m(a){var b=a.attr("data-type").split("");return b[0]=b[0].toUpperCase(),b=b.join("")}var n={},o=null,p=d3.select(a),q={server:"http://127.0.0.1:3000/",errorMessage:'<div class="alert alert-danger">A problem occured creating the charts. Please try again later</div>',loadingMessage:'<i class="fa fa-refresh fa-spin"></i>'},r=null,s=null,t=null,u=null,v=null,w=!1,x=!1,y=!1;return dc.serverChart.attachEventsBarChart=function(a,b){b.selectAll("rect.bar").on("click",function(b,c){f(a,c)}),e(a,b)},dc.serverChart.attachEventsPieChart=function(a,b){b.selectAll("g.pie-slice").on("click",function(b,c){f(a,c)})},dc.serverChart.attachEventsRowChart=function(a,b){b.selectAll("g.row").selectAll("rect").on("click",function(b,c,d){f(a,d)})},dc.serverChart.attachEventsLineChart=function(a,b){b.selectAll("circle.dot").on("mousemove",function(){var a=d3.select(this);a.style("fill-opacity",.8),a.style("stroke-opacity",.8)}).on("mouseout",function(){var a=d3.select(this);a.style("fill-opacity",.01),a.style("stroke-opacity",.01)}),e(a,b)},n.render=function(){return g(),n},n.options=function(a){if(0===arguments.length)return q;for(var b in a)a.hasOwnProperty(b)&&(q[b]=a[b]);return n},k(),l(),n}}(),function(){"use strict";function a(a,c,d){c.selectAll(".axis").each(function(a,g){var h=d3.select(this),i=h.select("path.domain").node().getBBox(),j=h.selectAll("g.tick"),k=null!==/translate\([\d.]+,0\)/i.exec(d3.select(j[0][1]).attr("transform")),l=b(d.selectAll(".axis"),g),m=l.selectAll("g.tick"),n=parseFloat(d3.select(m[0][0]).select("text").text()),o=parseFloat(d3.select(m[0][m[0].length-1]).select("text").text()),p=c.select(k?".grid-line.vertical":".grid-line.horizontal"),q=d.select(k?".grid-line.vertical":".grid-line.horizontal");h.transition().duration(e).ease(f).attr("transform",l.attr("transform")),p.empty()||p.transition().duration(e).ease(f).attr("transform",q.attr("transform")),j.each(function(a,c){var d=d3.select(this),g=d.select("text"),h=parseFloat(g.text()),j=(h-n)/(o-n)*100,l=!1;if(m.each(function(a,g){var i=d3.select(this),j=i.select("text");if(parseFloat(j.text())===h&&(l=!0,d.transition().duration(e).ease(f).attr("transform",i.attr("transform")).attr("opacity",null).style("opacity",i.attr("opacity")).each("end",function(){d.select("text").text(i.select("text").text())}),!p.empty())){var k=b(p.selectAll("line"),c),m=b(q.selectAll("line"),g);k.transition().duration(e).ease(f).attr("x1",m.attr("x1")).attr("y1",m.attr("y1")).attr("x2",m.attr("x2")).attr("y2",m.attr("y2")).attr("transform",null).style("opacity",m.attr("opacity"))}}),!l){var r="";if(r=k?"translate("+i.width*j/100+", 0)":"translate(0, "+(i.height-i.height*j/100)+")",d.transition().duration(e).ease(f).attr("transform",r).style("opacity",0).each("end",function(){d.remove()}),!p.empty()){var s=b(p.selectAll("line"),c);s.transition().duration(e).ease(f).attr("transform",r).style("opacity",0).each("end",function(){s.remove()})}}})}),d.selectAll(".axis").each(function(a,g,h){var i=d3.select(this),j=i.selectAll("g.tick"),k=null!==/translate\([\d.]+,0\)/i.exec(d3.select(j[0][1]).attr("transform")),l=b(c.selectAll(".axis"),g),m=l.select("path.domain").node().getBBox(),n=l.selectAll("g.tick"),o=parseFloat(d3.select(n[0][0]).select("text").text()),p=parseFloat(d3.select(n[0][n[0].length-1]).select("text").text()),q=c.select(k?".grid-line.vertical":".grid-line.horizontal"),r=d.select(k?".grid-line.vertical":".grid-line.horizontal");j.each(function(a,c){var d=d3.select(this),g=d.select("text"),h=d.select("line"),i=parseFloat(g.text()),j=(i-o)/(p-o)*100,s=!1;if(n.each(function(a,b){var c=d3.select(this),d=c.select("text");parseFloat(d.text())===i&&(s=!0)}),!s){var t=0,u="",v="",w=null;w=q.empty()?d.select("line.grid-line"):b(r.selectAll("line"),c),k?(t=m.width*j/100,u="translate("+t+", 0)",v="translate("+(t-w.attr("x1"))+", 0)"):(t=m.height-m.height*j/100,u="translate(0, "+t+")",v="translate(0, "+(t-w.attr("y1"))+")");var x=l.append("g").attr("class","tick").attr("transform",u).attr("opacity",0);x.transition().duration(e).ease(f).attr("transform",d.attr("transform")).style("opacity",1),x.append("text").attr("x",g.attr("x")).attr("y",g.attr("y")).attr("dy",g.attr("dy")).attr("style",g.attr("style")).text(g.text()),x.append("line").attr("x1",h.attr("x1")).attr("y1",h.attr("y1")).attr("x2",h.attr("x2")).attr("y2",h.attr("y2")),q.empty()?x.append("line").attr("class",w.attr("class")).attr("x1",w.attr("x1")).attr("y1",w.attr("y1")).attr("x2",w.attr("x2")).attr("y2",w.attr("y2")):q.append("line").attr("x1",w.attr("x1")).attr("y1",w.attr("y1")).attr("x2",w.attr("x2")).attr("y2",w.attr("y2")).attr("transform",v).attr("opacity",0).transition().duration(e).ease(f).attr("transform","translate(0, 0)").style("opacity",1)}})})}function b(a,b){return a.filter(function(a,c){return c===b})}function c(a){var b=a.match(g);if(!b)return{startAngle:0,endAngle:2*Math.PI};var c={x1:parseFloat(b[5]),y1:parseFloat(b[6]),x2:parseFloat(b[1]),y2:parseFloat(b[2]),x3:parseFloat(b[3]),y3:parseFloat(b[4])},e={startAngle:d(Math.atan2(c.y2-c.y1,c.x2-c.x1)),endAngle:d(Math.atan2(c.y3-c.y1,c.x3-c.x1))};return e.startAngle<0&&(e.startAngle=0),(e.endAngle>2*Math.PI||e.endAngle<e.startAngle)&&(e.endAngle=2*Math.PI),e}function d(a){var b=.5*Math.PI;return a>=0?b+a:a>=-b?b-Math.abs(a):2.5*Math.PI-Math.abs(a)}var e=350,f="quad-in",g=new RegExp(["M ?([\\d\\.e-]+) ?, ?([\\d\\.e-]+) ?","A ?","[\\d\\.e-]+ ?, ?[\\d\\.e-]+ ?,? ","\\d ,? ?","\\d ?,? ?","\\d ?,? ?","([\\d\\.e-]+) ?,? ?([\\d\\.e-]+) ?","L ?([\\d\\.e-]+) ?,? ?([\\d\\.e-]+)","Z"].join(""));dc.serverChart.redrawPieChart=function(a,d,g){var h=d.select("svg"),i=d.selectAll("g.pie-slice"),j=g.selectAll("g.pie-slice");d.selectAll("text").each(function(a,c){var d=d3.select(this),h=b(g.selectAll("text"),c);d.text(h.text()).transition().duration(e).ease(f).attr("transform",h.attr("transform"))}),i.attr("class",function(a,c){return b(j,c).attr("class")}),i.select("title").text(function(a,c){return b(j,c).select("title").text()}),i.select("path").transition().duration(e).ease(f).attrTween("d",function(a,d,e){var f=d3.min([h.attr("width"),h.attr("height")])/2,g=d3.svg.arc().outerRadius(f).innerRadius(0),i=b(j,d).select("path").attr("d"),k=d3.interpolate(c(e),c(i));return function(a){return g(k(a))}})},dc.serverChart.redrawBarChart=function(c,d,g){var h=d.selectAll("rect.bar"),i=g.selectAll("rect.bar");h.each(function(a,c){var d=d3.select(this),g=b(i,c);d.attr("class",g.attr("class")).attr("fill",g.attr("fill")).transition().duration(e).ease(f).attr("x",g.attr("x")).attr("y",g.attr("y")).attr("width",g.attr("width")).attr("height",g.attr("height"))}),h.select("title").each(function(a,c){var d=d3.select(this),e=b(i,c).select("title");d.text(e.text())}),a(c,d,g)},dc.serverChart.redrawRowChart=function(c,d,g){d.selectAll("g.row").each(function(a,c){var d=d3.select(this),h=b(g.selectAll("g.row"),c),i=h.select("rect"),j=h.select("text"),k=h.select("title");d.transition().duration(e).ease(f).attr("transform",h.attr("transform")),d.select("rect").attr("class",i.attr("class")).transition().duration(e).ease(f).attr("width",i.attr("width")).attr("height",i.attr("height")).attr("fill",i.attr("fill")).attr("transform",i.attr("transform")),d.select("text").text(j.text()).transition().duration(e).ease(f).attr("x",j.attr("x")).attr("y",j.attr("y")).attr("dy",j.attr("dy")).attr("transform",j.attr("transform")),d.select("title").text(k.text())}),a(c,d,g)},dc.serverChart.redrawLineChart=function(c,d,g){d.selectAll("g.stack").each(function(a,c){var d=d3.select(this),h=b(g.selectAll("g.stack"),c);d.selectAll("path").each(function(a,c){var d=d3.select(this),g=b(h.selectAll("path"),c);d.transition().duration(e).ease(f).attr("stroke",g.attr("stroke")).attr("d",g.attr("d"))})}),a(c,d,g)}}();