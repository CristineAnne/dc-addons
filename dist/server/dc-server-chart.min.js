/*!
 * dc-addons v0.8.1
 *
 * 2015-07-28 08:20:39
 *
 */
!function(){"use strict";"dc"in window||(window.dc={}),dc.serverChart=function(a){function b(a){var b=document.createElement("div");b.innerHTML=a,b=d3.select(b),o.selectAll(".dc-chart").each(function(a,d){var e=d3.select(this),f=b.selectAll(".dc-chart").filter(function(a,b){return b===d}),g=l(e);"function"==typeof dc.serverChart["redraw"+g]?dc.serverChart["redraw"+g](d,e,f):(e.html(f.html()),c())})}function c(){o.selectAll(".dc-chart").each(function(a,b){var c=d3.select(this),d=l(c);"function"==typeof dc.serverChart["attachEvents"+d]&&dc.serverChart["attachEvents"+d](b,c)})}function d(a,b){if(b.select("g.brush").size()>0){var c=b.select("g.brush").select(".background").attr("width");b.select("g.brush").on("mousedown",function(){q=d3.mouse(this),u=s,t=r}).on("mousemove",function(){if(null!==q){var a=d3.mouse(this),b=d3.select(this),d=null;if(v){var e=a[0]-q[0];s=u+e,r=t+e,0>s&&(s=0,r=t-u),r>c&&(r=c,s=c-(t-u))}else w?(s=s,r=a[0],s>r&&(d=s,s=r,r=d,w=!1,x=!0),0>s&&(s=0),r>c&&(r=c)):x?(s=a[0],r=r,s>r&&(d=s,s=r,r=d,w=!0,x=!1),0>s&&(s=0),r>c&&(r=c)):(s=d3.min([a[0],q[0]]),r=d3.max([a[0],q[0]]),0>s&&(s=0),r>c&&(r=c));b.select(".extent").attr("x",s).attr("width",r-s),b.selectAll("g.resize").style("display","inline"),b.select("g.resize.e").attr("transform","translate("+r+", 0)"),b.select("g.resize.w").attr("transform","translate("+s+", 0)")}}).on("mouseup",function(){var b=d3.mouse(this),c=d3.select(this);null===q||b[0]===q[0]?(c.select(".extent").attr("width",0),c.selectAll("g.resize").style("display","none"),e(a,[null,null])):e(a,[s,r]),q=null}),b.select("g.brush").select(".extent").on("mousedown",function(){v=!0}).on("mouseup",function(){v=!1}),b.select("g.brush").select("g.resize.e").on("mousedown",function(){w=!0}).on("mouseup",function(){w=!1}),b.select("g.brush").select("g.resize.w").on("mousedown",function(){x=!0}).on("mouseup",function(){x=!1})}}function e(a,b){n.emit("filter",[a,b])}function f(){if(j(),!p.name)throw Error("Name is a required option");n.emit("render",p.name)}function g(a){o.selectAll("*").remove();for(var b=0;b<a.length;b++)o.append("div").style("width",a[b].width+"px").style("height",a[b].height+"px").style("float","left").style("text-align","center").style("line-height",a[b].height+"px").html(p.loadingMessage)}function h(a){o.html(a),c()}function i(a){o.html(p.errorMessage),console.warn(a)}function j(){o.html(p.loadingMessage)}function k(){n=io(p.server,{reconnectionDelay:500,reconnectionDelayMax:2e3,reconnectionAttempts:4}),n.on("preRender",g),n.on("afterRender",h),n.on("afterRenderError",i),n.on("afterFilter",b),n.on("afterFilterError",i),n.io.on("reconnecting",function(){o.html(p.reconnectingMessage)}),n.io.on("reconnect_failed",function(){o.html(p.connectionErrorMessage)})}function l(a){var b=a.attr("data-type").split("");return b[0]=b[0].toUpperCase(),b=b.join("")}var m={},n=null,o=d3.select(a),p={name:null,server:"http://127.0.0.1:3000/",errorMessage:"A problem occurred creating the charts. Please try again later",loadingMessage:"Loading",reconnectingMessage:"There appears to be a problem connecting to the server. Retyring...",connectionErrorMessage:"Could not connect to the server."},q=null,r=null,s=null,t=null,u=null,v=!1,w=!1,x=!1;return dc.serverChart.attachEventsBarChart=function(a,b){b.selectAll("rect.bar").on("click",function(b,c){e(a,c)}),d(a,b)},dc.serverChart.attachEventsPieChart=function(a,b){b.selectAll("g.pie-slice").on("click",function(b,c){e(a,c)})},dc.serverChart.attachEventsRowChart=function(a,b){b.selectAll("g.row").selectAll("rect").on("click",function(b,c,d){e(a,d)})},dc.serverChart.attachEventsLineChart=function(a,b){b.selectAll("circle.dot").on("mousemove",function(){var a=d3.select(this);a.style("fill-opacity",.8),a.style("stroke-opacity",.8)}).on("mouseout",function(){var a=d3.select(this);a.style("fill-opacity",.01),a.style("stroke-opacity",.01)}),d(a,b)},m.render=function(){return k(),f(),m},m.options=function(a){if(0===arguments.length)return p;for(var b in a)a.hasOwnProperty(b)&&(p[b]=a[b]);return m},j(),m}}();