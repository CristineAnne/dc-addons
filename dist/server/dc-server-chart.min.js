/*!
 * dc-addons v0.8.0
 *
 * 2015-07-27 09:16:06
 *
 */
!function(){"use strict";"dc"in window||(window.dc={}),dc.serverChart=function(a,b){function c(a){var b=document.createElement("div");b.innerHTML=a,b=d3.select(b),p.selectAll(".dc-chart").each(function(a,c){var e=d3.select(this),f=b.selectAll(".dc-chart").filter(function(a,b){return b===c}),g=m(e);"function"==typeof dc.serverChart["redraw"+g]?dc.serverChart["redraw"+g](c,e,f):(e.html(f.html()),d())})}function d(){p.selectAll(".dc-chart").each(function(a,b){var c=d3.select(this),d=m(c);"function"==typeof dc.serverChart["attachEvents"+d]&&dc.serverChart["attachEvents"+d](b,c)})}function e(a,b){if(b.select("g.brush").size()>0){var c=b.select("g.brush").select(".background").attr("width");b.select("g.brush").on("mousedown",function(){r=d3.mouse(this),v=t,u=s}).on("mousemove",function(){if(null!==r){var a=d3.mouse(this),b=d3.select(this),d=null;if(w){var e=a[0]-r[0];t=v+e,s=u+e,0>t&&(t=0,s=u-v),s>c&&(s=c,t=c-(u-v))}else x?(t=t,s=a[0],t>s&&(d=t,t=s,s=d,x=!1,y=!0),0>t&&(t=0),s>c&&(s=c)):y?(t=a[0],s=s,t>s&&(d=t,t=s,s=d,x=!0,y=!1),0>t&&(t=0),s>c&&(s=c)):(t=d3.min([a[0],r[0]]),s=d3.max([a[0],r[0]]),0>t&&(t=0),s>c&&(s=c));b.select(".extent").attr("x",t).attr("width",s-t),b.selectAll("g.resize").style("display","inline"),b.select("g.resize.e").attr("transform","translate("+s+", 0)"),b.select("g.resize.w").attr("transform","translate("+t+", 0)")}}).on("mouseup",function(){var b=d3.mouse(this),c=d3.select(this);null===r||b[0]===r[0]?(c.select(".extent").attr("width",0),c.selectAll("g.resize").style("display","none"),f(a,[null,null])):f(a,[t,s]),r=null}),b.select("g.brush").select(".extent").on("mousedown",function(){w=!0}).on("mouseup",function(){w=!1}),b.select("g.brush").select("g.resize.e").on("mousedown",function(){x=!0}).on("mouseup",function(){x=!1}),b.select("g.brush").select("g.resize.w").on("mousedown",function(){y=!0}).on("mouseup",function(){y=!1})}}function f(a,b){o.emit("filter",[a,b])}function g(){k(),o.emit("render",b)}function h(a){p.selectAll("*").remove();for(var b=0;b<a.length;b++)p.append("div").style("width",a[b].width+"px").style("height",a[b].height+"px").style("float","left").style("text-align","center").style("line-height",a[b].height+"px").html(q.loadingMessage)}function i(a){p.html(a),d()}function j(a){p.html(q.errorMessage),console.warn(a)}function k(){p.html(q.loadingMessage)}function l(){o=io(q.server),o.on("preRender",h),o.on("afterRender",i),o.on("afterRenderError",j),o.on("afterFilter",c),o.on("afterFilterError",j)}function m(a){var b=a.attr("data-type").split("");return b[0]=b[0].toUpperCase(),b=b.join("")}var n={},o=null,p=d3.select(a),q={server:"http://127.0.0.1:3000/",errorMessage:'<div class="alert alert-danger">A problem occured creating the charts. Please try again later</div>',loadingMessage:'<i class="fa fa-refresh fa-spin"></i>'},r=null,s=null,t=null,u=null,v=null,w=!1,x=!1,y=!1;return dc.serverChart.attachEventsBarChart=function(a,b){b.selectAll("rect.bar").on("click",function(b,c){f(a,c)}),e(a,b)},dc.serverChart.attachEventsPieChart=function(a,b){b.selectAll("g.pie-slice").on("click",function(b,c){f(a,c)})},dc.serverChart.attachEventsRowChart=function(a,b){b.selectAll("g.row").selectAll("rect").on("click",function(b,c,d){f(a,d)})},dc.serverChart.attachEventsLineChart=function(a,b){b.selectAll("circle.dot").on("mousemove",function(){var a=d3.select(this);a.style("fill-opacity",.8),a.style("stroke-opacity",.8)}).on("mouseout",function(){var a=d3.select(this);a.style("fill-opacity",.01),a.style("stroke-opacity",.01)}),e(a,b)},n.render=function(){return g(),n},n.options=function(a){if(0===arguments.length)return q;for(var b in a)a.hasOwnProperty(b)&&(q[b]=a[b]);return n},k(),l(),n}}();